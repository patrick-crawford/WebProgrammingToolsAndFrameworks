"use strict";(self.webpackChunkOERTemplate=self.webpackChunkOERTemplate||[]).push([[1274],{8453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>a});var n=s(6540);const r={},o=n.createContext(r);function i(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(o.Provider,{value:t},e.children)}},8596:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/ajax-payload-5ae8422eab84120b943c82566d54f336.png"},8812:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"Web-API-Overview/api-introduction-and-implementation","title":"API Introduction & Implementation","description":"API Introduction & Implementation","source":"@site/docs/Web-API-Overview/api-introduction-and-implementation.md","sourceDirName":"Web-API-Overview","slug":"/Web-API-Overview/api-introduction-and-implementation","permalink":"/WebProgrammingToolsAndFrameworks/Web-API-Overview/api-introduction-and-implementation","draft":false,"unlisted":false,"editUrl":"https://github.com/catherine-leung/OERTemplate/tree/main/docs/Web-API-Overview/api-introduction-and-implementation.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"api-introduction-and-implementation","title":"API Introduction & Implementation","sidebar_position":3,"description":"API Introduction & Implementation"},"sidebar":"courseNotesSidebar","previous":{"title":"AJAX Review","permalink":"/WebProgrammingToolsAndFrameworks/Web-API-Overview/ajax-review"},"next":{"title":"Example Code","permalink":"/WebProgrammingToolsAndFrameworks/Web-API-Overview/example-code"}}');var r=s(4848),o=s(8453);const i={id:"api-introduction-and-implementation",title:"API Introduction & Implementation",sidebar_position:3,description:"API Introduction & Implementation"},a="API Introduction & Implementation",d={},l=[{value:"Route Configuration",id:"route-configuration",level:2},{value:"AJAX Testing (View)",id:"ajax-testing-view",level:2},{value:"Adding Data (JSON)",id:"adding-data-json",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"api-introduction--implementation",children:"API Introduction & Implementation"})}),"\n",(0,r.jsxs)(t.p,{children:["You may have heard of the term ",(0,r.jsx)(t.strong,{children:"REST"})," or ",(0,r.jsx)(t.strong,{children:"RESTful"})," API when reading about Web Programming. For our purposes, this can be described as way to use the HTTP protocol (ie, ",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc7231#section-4.3.1",children:'"GET"'}),", ",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc7231#section-4.3.3",children:'"POST"'}),", ",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc7231#section-4.3.4",children:'"PUT"'}),", ",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc7231#section-4.3.5",children:'"DELETE"'}),", etc.) with a standard message format (ie, JSON or XML) to preform CRUD operations (",(0,r.jsx)(t.strong,{children:"C"}),"reate, ",(0,r.jsx)(t.strong,{children:"R"}),"ead, ",(0,r.jsx)(t.strong,{children:"U"}),"pdate, ",(0,r.jsx)(t.strong,{children:"D"}),"elete) on a data source."]}),"\n",(0,r.jsx)(t.admonition,{type:"caution",children:(0,r.jsxs)(t.p,{children:["To truly create a ",(0,r.jsx)(t.em,{children:"fully compliant"})," ",(0,r.jsx)(t.strong,{children:"REST API"})," we must conform to the standards outlined in Roy Fielding's PhD dissertation, ",(0,r.jsx)(t.a,{href:"http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm",children:"Architectural Styles and the Design of Network-based Software Architectures"}),'. The design pattern that we are using here could more appropriately be called a "Web API".']})}),"\n",(0,r.jsx)(t.p,{children:"What makes this architecture so valuable, is that we remove any assumptions about how a client will access the data. A client could make HTTP requests to the API from a website, mobile app, etc. and it would be the website or app's job to correctly render the data once it's received. This simplifies development of front-end applications that use the data and even removes any specific programming language requirements for the client. If it can handle HTTP requests / responses and JSON, it can use our data."}),"\n",(0,r.jsx)(t.h2,{id:"route-configuration",children:"Route Configuration"}),"\n",(0,r.jsx)(t.p,{children:"Before we think about getting any kind of persistent storage involved however, let's first see how we can configure all of our routes in our server to allow for CRUD operations on a simple collection of users in the format"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"{userId: number, fName: string, lName: string}\n"})}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Route"}),(0,r.jsx)(t.th,{children:"HTTP Method"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"/api/users"}),(0,r.jsx)(t.td,{children:"GET"}),(0,r.jsx)(t.td,{children:"Get all the users"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"/api/users"}),(0,r.jsx)(t.td,{children:"POST"}),(0,r.jsx)(t.td,{children:"Create a user"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsxs)(t.td,{children:["/api/users/",":userId"]}),(0,r.jsx)(t.td,{children:"GET"}),(0,r.jsx)(t.td,{children:"Get a single user"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsxs)(t.td,{children:["/api/users/",":userId"]}),(0,r.jsx)(t.td,{children:"PUT"}),(0,r.jsx)(t.td,{children:"Update a user with new information"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsxs)(t.td,{children:["/api/users/",":userId"]}),(0,r.jsx)(t.td,{children:"DELETE"}),(0,r.jsx)(t.td,{children:"Delete a user"})]})]})]}),"\n",(0,r.jsx)(t.p,{children:"When these routes are applied to our Express server code, we get something that looks like this:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:"const express = require('express');\nconst app = express();\n\nconst HTTP_PORT = process.env.PORT || 8080;\n\napp.get('/api/users', (req, res) => {\n  res.send({ message: 'fetch all users' });\n});\n\napp.post('/api/users', (req, res) => {\n  res.send({ message: 'add a user' });\n});\n\napp.get('/api/users/:userId', (req, res) => {\n  res.send({ message: `get user with Id: ${req.params.userId}` });\n});\n\napp.put('/api/users/:userId', (req, res) => {\n  res.send({ message: `update User with Id: ${req.params.userId}` });\n});\n\napp.delete('/api/users/:userId', (req, res) => {\n  res.send({ message: `delete User with Id: ${req.params.userId}` });\n});\n\n// setup http server to listen on HTTP_PORT\napp.listen(HTTP_PORT, () => {\n  console.log(`Express http server listening on: ${HTTP_PORT}`);\n});\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Here, we have made use of the ",(0,r.jsx)(t.a,{href:"https://expressjs.com/en/api.html#req",children:"request"})," object's ",(0,r.jsx)(t.a,{href:"https://expressjs.com/en/api.html#req.params",children:"params method"})," to identify the specific user that needs to be fetched, updated or deleted based on the URL alone. In a sense, what we're allowing here is for the URL + HTTP Method to act as a way of querying the data source, as ",(0,r.jsx)(t.strong,{children:"/api/users/3"}),", ",(0,r.jsx)(t.strong,{children:"/api/users/4923"})," or even ",(0,r.jsx)(t.strong,{children:"/api/users/twelve"})," will all be accepted. They may not necessarily return valid data, but the routes will be found by our server and we can attempt to preform the requested operation."]}),"\n",(0,r.jsx)(t.h2,{id:"ajax-testing-view",children:"AJAX Testing (View)"}),"\n",(0,r.jsxs)(t.p,{children:['Now that we have all of the routes for our API in place, let\'s create a "view" that will make AJAX requests to test our API functionality. To begin, create a ',(0,r.jsx)(t.strong,{children:"views"})," folder and add the file ",(0,r.jsx)(t.strong,{children:"index.html"}),". This will be a simple HTML page consisting of 5 buttons (each corresponding to a piece of functionality in our API) and some simple JavaScript to make an AJAX request."]}),"\n",(0,r.jsx)(t.p,{children:"However, since we are serving this file from the same server that our API is on, we will need to add some additional code to our server file; specifically:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:"const path = require('path');\n"})}),"\n",(0,r.jsx)(t.p,{children:"and"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:"app.get('/', (req, res) => {\n  res.sendFile(path.join(__dirname, '/views/index.html'));\n});\n"})}),"\n",(0,r.jsx)(t.p,{children:'Finally - our server is setup and ready to serve the index.html file at our main route ("/"). Our next step is to add our client-side logic / JS to the index.html file. Here, we hard-code some requests to the API and output their results to the web console to make sure they function correctly:'}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-html",children:'<!doctype html>\n<html>\n  <head>\n      <title>API Test</title>\n      <script>\n          function makeAJAXRequest(method, url, body) {\n              fetch(url, {\n                  method: method,\n                  body: JSON.stringify(body), // if missing \'body\', \'undefined\' is returned\n                  headers: { \'Content-Type\': \'application/json\' }\n              })\n              .then(response => response.json())\n              .then(json => {\n                  console.log(json);\n              });\n          }\n      <\/script>\n  </head>\n  <body>\n      <p>Test the API by outputting to the browser console:</p>\n      \x3c!-- Get All Users --\x3e\n      <button type="button" onclick=\'makeAJAXRequest("GET", "/api/users")\'>Get All Users</button><br /><br />\n      \x3c!-- Add New User --\x3e\n      <button type="button" onclick=\'makeAJAXRequest("POST", "/api/users", {fName: "Bob", lName: "Jones"})\'>Add New User</button><br /><br />\n      \x3c!-- Get User By Id --\x3e\n      <button type="button" onclick=\'makeAJAXRequest("GET", "/api/users/2")\'>Get User</button><br /><br />\n      \x3c!-- Update User By Id --\x3e\n      <button type="button" onclick=\'makeAJAXRequest("PUT", "/api/users/2", {fName: "Wanda", lName: "Smith"})\'>Update User</button><br /><br />\n      \x3c!-- Delete User By Id --\x3e\n      <button type="button" onclick=\'makeAJAXRequest("DELETE", "/api/users/2")\'>Delete User</button>\n  </body>\n</html>\n'})}),"\n",(0,r.jsx)(t.h2,{id:"adding-data-json",children:"Adding Data (JSON)"}),"\n",(0,r.jsxs)(t.p,{children:["Once you have entered the above code, save the changes and try running the server locally - you will see that All of the routes tested return a JSON formatted message. This confirms that our Web API will correctly respond to AJAX requests made by the client. Additionally, If you open the ",(0,r.jsx)(t.strong,{children:"Network tab"})," (Google Chrome) before initiating one of the calls to ",(0,r.jsx)(t.strong,{children:"Update"})," or ",(0,r.jsx)(t.strong,{children:"Add a New User"}),", you will see that our request is also carrying a payload of information, ie:"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"AJAX Request Payload",src:s(8596).A+"",width:"1426",height:"298"})}),"\n",(0,r.jsxs)(t.p,{children:['If we wish to capture this information in our routes (so that we can make the appropriate updates to our data source), we must make some small modifications to our server.js file and individual routes (ie: POST to "/api/users" & PUT to "/api/users/',":userId",'"). The first thing that we must do is incorporate middleware to parse the incoming data, ie:']}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:"app.use(express.json());\n"})}),"\n",(0,r.jsxs)(t.p,{children:["This should allow our routes to access data passed to our API using the ",(0,r.jsx)(t.a,{href:"https://expressjs.com/en/api.html#req.body",children:"req.body"})," property. More specifically, we can update our POST & PUT routes to use req.body to fetch the new / updated ",(0,r.jsx)(t.strong,{children:"fName"})," and ",(0,r.jsx)(t.strong,{children:"lName"})," properties:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:"app.post('/api/users', (req, res) => {\n  res.send({ message: `add the user: ${req.body.fName} ${req.body.lName}` });\n});\n"})}),"\n",(0,r.jsx)(t.p,{children:"and"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:"app.put('/api/users/:userId', (req, res) => {\n  res.send({ message: `update User with Id: ${req.params.userId} to ${req.body.fName} ${req.body.lName}` });\n});\n"})}),"\n",(0,r.jsx)(t.p,{children:"If we try running the server to test the API again, we will see that the messages returned back from the server correctly echo the data sent to the API. We now have everything that we need to preform simple CRUD operations via AJAX on a data source using a web service. The only thing missing is the data store itself."}),"\n",(0,r.jsx)(t.admonition,{type:"caution",children:(0,r.jsxs)(t.p,{children:["If we want to allow the API to respond to requests from ",(0,r.jsx)(t.em,{children:"outside"})," the domain (this is what ",(0,r.jsx)(t.a,{href:"https://jsonplaceholder.typicode.com/",children:"https://jsonplaceholder.typicode.com"})," does), we will have to enable ",(0,r.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS",children:"Cross-Origin Resource Sharing (CORS)"})," - see the third-party ",(0,r.jsx)(t.a,{href:"https://www.npmjs.com/package/cors",children:"CORS middleware"})]})})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);